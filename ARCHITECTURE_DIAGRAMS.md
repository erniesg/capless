# Capless Architecture Diagrams & Data Models

## 1. Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAPLESS: AI Parliament Content Platform                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INPUT: Singapore Parliament                                                      â”‚
â”‚ â”œâ”€ Hansard API: https://sprs.parl.gov.sg/search (JSON format)                   â”‚
â”‚ â””â”€ YouTube Channel: Official Parliament videos                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  CAPLESS-INGEST       â”‚
            â”‚  (59/59 tests âœ…)     â”‚
            â”‚  Responsibility:      â”‚
            â”‚  - Fetch Hansard API  â”‚
            â”‚  - Parse HTML content â”‚
            â”‚  - Normalize segments â”‚
            â”‚  - Cache in Redis     â”‚
            â”‚  - Store in R2        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                       â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ MOMENTS    â”‚         â”‚ VIDEO MATCHER  â”‚
      â”‚ (All âœ…)   â”‚         â”‚ (35/39 âš ï¸)     â”‚
      â”‚            â”‚         â”‚                â”‚
      â”‚ - Extract  â”‚         â”‚ - YouTube      â”‚
      â”‚   viral    â”‚         â”‚   search       â”‚
      â”‚   quotes   â”‚         â”‚ - Confidence   â”‚
      â”‚ - GPT-4o   â”‚         â”‚   scoring      â”‚
      â”‚   analysis â”‚         â”‚ - Timestamp    â”‚
      â”‚ - Virality â”‚         â”‚   extraction   â”‚
      â”‚   scoring  â”‚         â”‚ - Cache        â”‚
      â”‚ - Vector   â”‚         â”‚   matches      â”‚
      â”‚   embed    â”‚         â”‚ - Store in R2  â”‚
      â”‚ - Vectorizeâ”‚         â”‚                â”‚
      â”‚   index    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
            â”‚                         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ASSET GENERATOR       â”‚
            â”‚  (ğŸš§ ~80% complete)    â”‚
            â”‚                         â”‚
            â”‚ - Generate 4 scripts    â”‚
            â”‚   (persona-based)       â”‚
            â”‚ - Judge + select winner â”‚
            â”‚ - ElevenLabs TTS        â”‚
            â”‚ - Image generation      â”‚
            â”‚ - Store audio + images  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ VIDEO COMPOSITOR       â”‚
            â”‚ (ğŸš§ ~30% complete)     â”‚
            â”‚                         â”‚
            â”‚ - Modal rendering       â”‚
            â”‚ - Job polling           â”‚
            â”‚ - R2 download           â”‚
            â”‚ - Platform publishing   â”‚
            â”‚   * TikTok              â”‚
            â”‚   * Instagram           â”‚
            â”‚   * YouTube             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  OUTPUT: Social Media   â”‚
            â”‚                         â”‚
            â”‚ â€¢ TikTok (1-3min video) â”‚
            â”‚ â€¢ Instagram Reels       â”‚
            â”‚ â€¢ YouTube Shorts        â”‚
            â”‚                         â”‚
            â”‚ Status: Real-time       â”‚
            â”‚ Reach: Thousands        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Data Flow: End-to-End Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE DATA TRANSFORMATION FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STAGE 1: INGESTION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Input: Hansard JSON (Parliament API)â”‚
â”‚ {                                    â”‚
â”‚   metadata: {                        â”‚
â”‚     sittingDate: "02-07-2024"       â”‚
â”‚     speakers: ["Minister X", ...]    â”‚
â”‚   }                                  â”‚
â”‚   takesSectionVOList: [{             â”‚
â”‚     title: "Oral Answer"             â”‚
â”‚     content: "<html>speeches</html>" â”‚
â”‚   }]                                 â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        (parse HTML, normalize, segment)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Processed: Transcript (R2 + Redis)  â”‚
â”‚ {                                    â”‚
â”‚   transcript_id: "2024-07-02-s1"    â”‚
â”‚   segments: [{                       â”‚
â”‚     id: "...-0"                      â”‚
â”‚     speaker: "Minister X"            â”‚
â”‚     text: "Clean text..."            â”‚
â”‚     timestamp: "12:00 pm"            â”‚
â”‚     section: "Oral Answer"           â”‚
â”‚   }]                                 â”‚
â”‚   metadata: {...}                    â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STAGE 2: MOMENT EXTRACTION
                 â”‚
        (send to Moments worker)
                 â”‚
        (GPT-4o: analyze all segments)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Output: Viral Moments                â”‚
â”‚ [{                                   â”‚
â”‚   moment_id: "m-xyz789"             â”‚
â”‚   quote: "specific quote (50 words)" â”‚
â”‚   speaker: "Minister X"              â”‚
â”‚   virality_score: 8.5 / 10           â”‚
â”‚   why_viral: "unclear jargon..."     â”‚
â”‚   emotional_tone: "sarcastic"        â”‚
â”‚   target_demo: "Gen Z, concerned..." â”‚
â”‚ }]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        (generate embeddings)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vector Search Index (Vectorize)      â”‚
â”‚ Moment embeddings (1536 dims)        â”‚
â”‚ Searchable by:                       â”‚
â”‚ - Topic ("healthcare")               â”‚
â”‚ - Tone ("sarcastic")                 â”‚
â”‚ - Demographic ("Gen Z")              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STAGE 3: VIDEO MATCHING (PARALLEL)
                 â”‚
        (send to Video Matcher)
                 â”‚
        (YouTube search by date)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ YouTube Video Match                  â”‚
â”‚ {                                    â”‚
â”‚   video_id: "n9ZyN-lwiXg"           â”‚
â”‚   title: "Parliament 22 Sep 2025"    â”‚
â”‚   duration: 4320 (seconds, 72min)    â”‚
â”‚   publish_date: "2025-09-22"         â”‚
â”‚   confidence_score: 9.2 / 10         â”‚
â”‚   match_criteria: [                  â”‚
â”‚     "date_match",                    â”‚
â”‚     "title_keywords",                â”‚
â”‚     "duration_appropriate"           â”‚
â”‚   ]                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        (cache in Redis + R2)
                 â”‚
        (extract exact timestamp)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Timestamp Match                      â”‚
â”‚ {                                    â”‚
â”‚   quote: "the knot that insurers..." â”‚
â”‚   start_timestamp: 2145 (seconds)    â”‚
â”‚   segment_url: "...&t=2145"          â”‚
â”‚   confidence: 8.7 / 10               â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STAGE 4: ASSET GENERATION
                 â”‚
        (Moments + Video Match)
                 â”‚
        (generate 4 persona scripts)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Persona Scripts (GPT-4o)             â”‚
â”‚ 1. Gen Z: "okay bestie so..."        â”‚
â”‚ 2. Uncle: "wah lau eh..."            â”‚
â”‚ 3. Auntie: "aiyoh how like that..." â”‚
â”‚ 4. Attenborough: "Here in the..."    â”‚
â”‚                                      â”‚
â”‚ Winner (Judge LLM): Gen Z âœ“          â”‚
â”‚ Reason: Best viral potential         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        (TTS for winning script)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TTS Audio (ElevenLabs)               â”‚
â”‚ File: moment_xyz_gen_z.mp3           â”‚
â”‚ Duration: 42 seconds                 â”‚
â”‚ Voice: Young female, 1.2x speed      â”‚
â”‚ Stored in: R2/audio/                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        (generate thumbnail)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Thumbnail Image                      â”‚
â”‚ File: moment_xyz_gen_z.png           â”‚
â”‚ Dims: 1080x1920 (TikTok 9:16)       â”‚
â”‚ Persona Branding: Gen Z emoji âœ¨    â”‚
â”‚ Stored in: R2/thumbnails/            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STAGE 5: VIDEO COMPOSITION
                 â”‚
        (Trigger Modal job)
                 â”‚
        (Remotion + FFmpeg rendering)
                 â”‚
        Poll job status (10s intervals)
                 â”‚
        ~120-180 seconds rendering
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rendered Video (MP4)                 â”‚
â”‚ File: job_abc123_tiktok.mp4          â”‚
â”‚ Duration: 45 seconds                 â”‚
â”‚ Size: ~50MB                          â”‚
â”‚ Codec: H.264, AAC audio              â”‚
â”‚ Format: 1080x1920 (TikTok optimized) â”‚
â”‚ Stored in: R2/videos/renders/        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        (publish to platforms)
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Platform Publishing                  â”‚
â”‚                                      â”‚
â”‚ 1. TikTok                            â”‚
â”‚    URL: tiktok.com/@capless_sg       â”‚
â”‚    Metadata: hashtags, description   â”‚
â”‚                                      â”‚
â”‚ 2. Instagram                         â”‚
â”‚    Format: Reels (4:5 aspect ratio)  â”‚
â”‚    Metadata: caption, hashtags       â”‚
â”‚                                      â”‚
â”‚ 3. YouTube                           â”‚
â”‚    Format: Shorts (9:16)             â”‚
â”‚    Metadata: title, description      â”‚
â”‚                                      â”‚
â”‚ Status: LIVE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Pipeline Time: ~4-5 minutes
Cost per Video: ~$0.73
Reach per Video: Thousands of views
```

---

## 3. Data Model: Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA RELATIONSHIPS & FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TRANSCRIPT          â”‚
â”‚                      â”‚
â”‚ transcript_id        â”‚ â—„â”€â”€â”€â”€â”€â”
â”‚ sitting_date         â”‚       â”‚
â”‚ speakers: []         â”‚       â”‚
â”‚ topics: []           â”‚       â”‚
â”‚ segments: [{         â”‚       â”‚
â”‚   segment_id         â”‚       â”‚
â”‚   speaker            â”‚       â”‚
â”‚   text               â”‚       â”‚
â”‚   timestamp          â”‚       â”‚
â”‚   section_title      â”‚       â”‚
â”‚ }]                   â”‚       â”‚
â”‚ metadata: {          â”‚       â”‚
â”‚   parliament_no      â”‚       â”‚
â”‚   session_no         â”‚       â”‚
â”‚   total_words        â”‚       â”‚
â”‚   attendance: []     â”‚       â”‚
â”‚ }                    â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
           â”‚                    â”‚
           â”‚                    â”‚
           â”‚ contains           â”‚
           â”‚                    â”‚
           â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  MOMENT              â”‚       â”‚
â”‚                      â”‚       â”‚
â”‚ moment_id            â”‚       â”‚
â”‚ quote                â”‚ (refs segment_ids)
â”‚ speaker              â”‚       â”‚
â”‚ virality_score: 0-10 â”‚       â”‚
â”‚ why_viral            â”‚       â”‚
â”‚ emotional_tone       â”‚       â”‚
â”‚ target_demographic   â”‚       â”‚
â”‚ embedding: []        â”‚       â”‚
â”‚ transcript_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ segment_ids: []      â”‚       â”‚
â”‚ created_at           â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
           â”‚                    â”‚
           â”‚                    â”‚
           â”‚ indexed_in        â”‚
           â”‚                   â”‚
           â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ VECTORIZE INDEX      â”‚      â”‚
â”‚                      â”‚      â”‚
â”‚ capless-moments      â”‚      â”‚
â”‚ â”œâ”€ moment embeddings â”‚      â”‚
â”‚ â”œâ”€ virality_score    â”‚      â”‚
â”‚ â”œâ”€ topic             â”‚      â”‚
â”‚ â”œâ”€ emotional_tone    â”‚      â”‚
â”‚ â””â”€ demographics      â”‚      â”‚
â”‚                      â”‚      â”‚
â”‚ Use: Semantic search â”‚      â”‚
â”‚ Query: "healthcare   â”‚      â”‚
â”‚  costs rising"       â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VIDEO MATCH         â”‚
â”‚                      â”‚
â”‚ video_id             â”‚
â”‚ video_url            â”‚
â”‚ title                â”‚
â”‚ duration             â”‚
â”‚ publish_date         â”‚
â”‚ confidence_score: 0-10
â”‚ match_criteria: []   â”‚
â”‚ transcript_id â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
â”‚ has_transcript       â”‚      â”‚
â”‚ metadata:            â”‚      â”‚
â”‚   description        â”‚      â”‚
â”‚   thumbnail_url      â”‚      â”‚
â”‚   view_count         â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
           â”‚                   â”‚
           â”‚ linked_to         â”‚
           â”‚                   â”‚
           â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ TIMESTAMP            â”‚       â”‚
â”‚                      â”‚       â”‚
â”‚ video_id             â”‚       â”‚
â”‚ quote_text           â”‚       â”‚
â”‚ start_timestamp      â”‚       â”‚
â”‚ end_timestamp        â”‚       â”‚
â”‚ segment_url          â”‚       â”‚
â”‚ confidence: 0-10     â”‚       â”‚
â”‚ method: "transcript" â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
           â”‚                   â”‚
           â”‚ located_in        â”‚
           â”‚                   â”‚
           â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  YOUTUBE VIDEO       â”‚       â”‚
â”‚  (from mapping)      â”‚       â”‚
â”‚                      â”‚       â”‚
â”‚ video_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”
â”‚ url                  â”‚          â”‚
â”‚ title                â”‚          â”‚
â”‚ sitting_date         â”‚          â”‚
â”‚ is_interpretation    â”‚          â”‚
â”‚ captions_available   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RENDERED VIDEO      â”‚
â”‚  (MP4 + metadata)    â”‚
â”‚                      â”‚
â”‚ job_id               â”‚
â”‚ moment_id            â”‚
â”‚ video_id             â”‚
â”‚ persona              â”‚
â”‚ status: "completed"  â”‚
â”‚ video_url (R2)       â”‚
â”‚ platforms_published: â”‚
â”‚   - tiktok: URL      â”‚
â”‚   - instagram: URL   â”‚
â”‚   - youtube: URL     â”‚
â”‚ created_at           â”‚
â”‚ published_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Workers Communication Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTER-WORKER COMMUNICATION                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ CLIENT / FRONTEND    â”‚
                    â”‚                      â”‚
                    â”‚ Manual triggers      â”‚
                    â”‚ Query endpoints      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚              â”‚
                â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   INGEST     â”‚ â”‚  MOMENTS     â”‚ â”‚   MATCHER    â”‚
        â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
        â”‚ /ingest      â”‚ â”‚ /extract     â”‚ â”‚ /match       â”‚
        â”‚              â”‚ â”‚ /analyze     â”‚ â”‚ /timestamp   â”‚
        â”‚ Fetches from â”‚ â”‚ /search      â”‚ â”‚              â”‚
        â”‚ Parliament   â”‚ â”‚ /trending    â”‚ â”‚ Searches     â”‚
        â”‚ API          â”‚ â”‚ /batch       â”‚ â”‚ YouTube      â”‚
        â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                â”‚               â”‚
               â”‚ Output:        â”‚ Output:      â”‚ Output:
               â”‚ Transcript    â”‚ Moments      â”‚ VideoMatch
               â”‚               â”‚              â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                           â”‚             â”‚
                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                      â”‚ R2 +    â”‚   â”‚ Redis   â”‚
                      â”‚ Vectorize  â”‚ Cache   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚             â”‚
                           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  ASSET GENERATOR           â”‚
                 â”‚  (Under development)       â”‚
                 â”‚                            â”‚
                 â”‚ Consumes: Moment + Video   â”‚
                 â”‚ /scripts - Generate 4      â”‚
                 â”‚ /audio   - TTS             â”‚
                 â”‚ /thumbnail - Images        â”‚
                 â”‚ /full    - Complete pkg    â”‚
                 â”‚                            â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Output:
                                â”‚ Scripts, Audio, Images
                                â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ VIDEO COMPOSITOR           â”‚
                 â”‚ (Under development)        â”‚
                 â”‚                            â”‚
                 â”‚ /compose - Trigger render  â”‚
                 â”‚ /status  - Job status      â”‚
                 â”‚ /publish - Multi-platform  â”‚
                 â”‚                            â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Output:
                                â”‚ Live Videos on
                                â”‚ TikTok/IG/YouTube
                                â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ SUPPORTING WORKERS         â”‚
                 â”‚                            â”‚
                 â”‚ parliament-chat            â”‚
                 â”‚  â””â”€ /chat - Q&A with RAG  â”‚
                 â”‚  â””â”€ /embed-session         â”‚
                 â”‚                            â”‚
                 â”‚ parliament-scraper         â”‚
                 â”‚  â””â”€ Automated scraping     â”‚
                 â”‚                            â”‚
                 â”‚ video-generator            â”‚
                 â”‚  â””â”€ Sora integration       â”‚
                 â”‚                            â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Storage Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLOUDFLARE STORAGE LAYER                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ R2 BUCKET: "capless"                                           â”‚
â”‚ (Durable, scalable object storage)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ â”œâ”€ transcripts/                                              â”‚
â”‚ â”‚  â”œâ”€ raw/                                                   â”‚
â”‚ â”‚  â”‚  â””â”€ 2024/07/02/session_123.json  (1.5MB Hansard JSON)  â”‚
â”‚ â”‚  â””â”€ processed/                                             â”‚
â”‚ â”‚     â””â”€ transcript_20240702_s1.json  (500KB normalized)     â”‚
â”‚ â”‚                                                            â”‚
â”‚ â”œâ”€ moments/                                                  â”‚
â”‚ â”‚  â”œâ”€ transcript_20240702_s1.json    (200KB 15 moments)     â”‚
â”‚ â”‚  â””â”€ transcript_20240705_s2.json    (180KB 12 moments)     â”‚
â”‚ â”‚                                                            â”‚
â”‚ â”œâ”€ audio/                                                    â”‚
â”‚ â”‚  â”œâ”€ moment_xyz_gen_z.mp3          (2.5MB 42sec)           â”‚
â”‚ â”‚  â”œâ”€ moment_xyz_uncle.mp3          (2.3MB 42sec)           â”‚
â”‚ â”‚  â”œâ”€ moment_xyz_auntie.mp3         (2.4MB 42sec)           â”‚
â”‚ â”‚  â””â”€ moment_xyz_attenborough.mp3   (2.2MB 42sec)           â”‚
â”‚ â”‚                                                            â”‚
â”‚ â”œâ”€ thumbnails/                                              â”‚
â”‚ â”‚  â”œâ”€ moment_xyz_gen_z.png          (650KB 1080x1920)       â”‚
â”‚ â”‚  â”œâ”€ moment_xyz_uncle.png          (680KB)                 â”‚
â”‚ â”‚  â””â”€ ...                                                   â”‚
â”‚ â”‚                                                            â”‚
â”‚ â””â”€ videos/                                                   â”‚
â”‚    â”œâ”€ renders/                                              â”‚
â”‚    â”‚  â”œâ”€ job_abc123_modal.mp4       (45MB raw output)       â”‚
â”‚    â”‚  â””â”€ job_abc456_modal.mp4       (48MB)                 â”‚
â”‚    â””â”€ published/                                             â”‚
â”‚       â”œâ”€ job_abc123_tiktok.mp4      (32MB optimized)        â”‚
â”‚       â”œâ”€ job_abc123_instagram.mp4   (28MB reels format)     â”‚
â”‚       â””â”€ job_abc123_youtube.mp4     (35MB shorts format)    â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REDIS (Upstash): Caching Layer                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ transcript:{id}                                              â”‚
â”‚  â†’ ProcessedTranscript JSON (1 hour TTL)                     â”‚
â”‚  â†’ Used by: Moments, Video Matcher                           â”‚
â”‚                                                             â”‚
â”‚ moment:{id}                                                 â”‚
â”‚  â†’ ViralMoment JSON (1 hour TTL)                           â”‚
â”‚  â†’ Used by: Asset Generator, Compositor                     â”‚
â”‚                                                             â”‚
â”‚ video_match:{transcript_id}                                 â”‚
â”‚  â†’ VideoMatchResponse JSON (1 hour TTL)                     â”‚
â”‚  â†’ Used by: Asset Generator, Compositor                     â”‚
â”‚                                                             â”‚
â”‚ rate:openai:{key}                                           â”‚
â”‚  â†’ Integer counter (1 minute TTL)                           â”‚
â”‚  â†’ Prevents OpenAI rate limit exceeding                     â”‚
â”‚                                                             â”‚
â”‚ rate:youtube:{key}                                          â”‚
â”‚  â†’ Integer counter (1 minute TTL)                           â”‚
â”‚  â†’ Prevents YouTube quota exhaustion                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VECTORIZE: Vector Search Index                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Index Name: capless-moments                                   â”‚
â”‚ Vector Dimension: 1536 (OpenAI embedding)                     â”‚
â”‚ Total Vectors: ~1000+ moments                                 â”‚
â”‚                                                                â”‚
â”‚ Indexed Fields:                                              â”‚
â”‚ â”œâ”€ moment_id (searchable)                                    â”‚
â”‚ â”œâ”€ embedding (vector similarity)                             â”‚
â”‚ â”œâ”€ virality_score (0-10)                                     â”‚
â”‚ â”œâ”€ topic (e.g., "healthcare", "education")                  â”‚
â”‚ â”œâ”€ emotional_tone (e.g., "sarcastic", "dramatic")           â”‚
â”‚ â””â”€ target_demographic (e.g., "Gen Z", "parents")            â”‚
â”‚                                                             â”‚
â”‚ Use Cases:                                                   â”‚
â”‚ 1. Find similar moments: "Find moments like healthcare..."  â”‚
â”‚ 2. Filter by topic: GET /moments?topic=education            â”‚
â”‚ 3. Sentiment analysis: GET /moments?tone=sarcastic           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ D1 DATABASE: Job Tracking (Future)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Currently: Using Durable Objects for job state                â”‚
â”‚ Future: Migrate to D1 SQLite for better queries               â”‚
â”‚                                                             â”‚
â”‚ Tables:                                                       â”‚
â”‚ â”œâ”€ render_jobs (job_id, status, progress, created_at)       â”‚
â”‚ â”œâ”€ transcripts (transcript_id, sitting_date, word_count)    â”‚
â”‚ â”œâ”€ moments (moment_id, transcript_id, virality_score)       â”‚
â”‚ â””â”€ videos (job_id, platforms_published, status)             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Data Size Estimates

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA VOLUME & STORAGE ESTIMATES                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Per Parliament Session (1 sitting day)
â”œâ”€ Raw Hansard JSON:        1-2 MB
â”œâ”€ Processed Transcript:    500 KB
â”œâ”€ Extracted Moments (20):  200 KB
â”œâ”€ Audio Files (4 personas, 20 moments):  ~200 MB
â”‚  â””â”€ @ 5 MB per persona script
â”œâ”€ Thumbnail Images:        20 MB (20 x 1 MB @ 1080x1920)
â””â”€ Total per Session:       ~220-230 MB

Monthly Storage (Assume 20 sessions/month)
â”œâ”€ Raw transcripts:         40 MB
â”œâ”€ Processed transcripts:   10 MB
â”œâ”€ Moments JSON:            4 MB
â”œâ”€ Audio files:            4,000 MB (4 GB)
â”œâ”€ Thumbnail images:         400 MB
â”œâ”€ Rendered videos:         900 MB (18-25 videos, 45-50 MB each)
â””â”€ Total:                  ~5.3 GB/month

Quarterly Growth (3 months)
â”œâ”€ Total storage:          ~16 GB
â”œâ”€ Cost @ $0.015/GB:       ~$0.24
â””â”€ Well within free tier

Annual Projection (12 months, 240 sessions)
â”œâ”€ Total storage:          ~55 GB
â”œâ”€ Cost @ $0.015/GB:       ~$0.82
â””â”€ Very economical

Vector Index (Vectorize)
â”œâ”€ 1,000 moments @ 1536 dims:    ~6 MB
â”œâ”€ Cost: Included with Workers
â””â”€ Unlimited storage (essentially)

Cache (Redis/Upstash)
â”œâ”€ Average 50-100 cached items:   ~100 KB
â”œâ”€ Daily refresh (1h TTL):
â”‚  â””â”€ ~100 API calls/day
â”œâ”€ Cost @ free tier:              $0
â””â”€ Upgrade: $20/month if needed
```

---

## 7. API Latency Profile

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API RESPONSE TIME BREAKDOWN                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

capless-ingest: Fetch & Normalize Parliament Hansard
â”œâ”€ Network:           500ms (Parliament API)
â”œâ”€ HTML parsing:      1000ms (extract segments)
â”œâ”€ Redis cache:       100ms (store)
â”œâ”€ R2 storage:        500ms (upload)
â”œâ”€ Total:             ~2.1 seconds
â””â”€ P95:               ~3 seconds

capless-moments: Extract Moments & Generate Embeddings
â”œâ”€ Load transcript:   100ms (R2 read)
â”œâ”€ OpenAI GPT-4o:    8000ms (AI analysis, 10-15sec sometimes)
â”œâ”€ Embedding gen:     500ms (text-embedding-3-small)
â”œâ”€ Vectorize index:   100ms (upsert)
â”œâ”€ Redis cache:       100ms (store results)
â”œâ”€ Total:             ~8.8 seconds
â””â”€ P95:               ~12 seconds

capless-video-matcher: Search & Match YouTube
â”œâ”€ Load transcript:   100ms (Redis/R2)
â”œâ”€ YouTube search:   2000ms (API latency)
â”œâ”€ Confidence calc:   200ms (scoring logic)
â”œâ”€ Timestamp extract: 1000ms (caption parsing)
â”œâ”€ Redis cache:       100ms
â”œâ”€ R2 storage:        200ms
â”œâ”€ Total:             ~3.6 seconds
â””â”€ P95:               ~5 seconds

asset-generator: Generate Scripts & Audio (Under Development)
â”œâ”€ Load moment:       100ms
â”œâ”€ Script generation (4x parallel):
â”‚  â”œâ”€ OpenAI calls:  5000ms (gpt-4o)
â”‚  â””â”€ Parallel:      -3000ms (saved)
â”œâ”€ Judge LLM:        2000ms
â”œâ”€ Audio TTS:        8000ms (ElevenLabs, per persona)
â”œâ”€ Thumbnail gen:    1000ms
â”œâ”€ R2 storage:        500ms
â”œâ”€ Total:             ~16-20 seconds
â””â”€ P95:               ~25 seconds

video-compositor: Modal Rendering & Publishing (Under Development)
â”œâ”€ Trigger Modal:    1000ms (job queue)
â”œâ”€ Poll for render:  120000ms (2 minutes, modal work)
â”œâ”€ Download video:   5000ms (R2 upload from Modal)
â”œâ”€ Platform publish: 10000ms (3 platforms in parallel)
â”‚  â”œâ”€ TikTok:        5000ms
â”‚  â”œâ”€ Instagram:     3000ms
â”‚  â””â”€ YouTube:       4000ms
â”œâ”€ Cache invalidate:  500ms
â”œâ”€ Total:            ~137 seconds (2.3 minutes)
â””â”€ P95:              ~180 seconds

End-to-End Pipeline
â”œâ”€ Ingest:           2s
â”œâ”€ Moments:          9s (parallel)
â”œâ”€ Video Matcher:    4s (parallel)
â”œâ”€ Assets:           20s
â”œâ”€ Composition:      140s
â””â”€ Total:            ~175 seconds (~3 minutes)
```

---

## 8. Consistency & Atomicity

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA CONSISTENCY GUARANTEES                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STRONG CONSISTENCY (R2)
â”œâ”€ Operations: Atomic write, read-after-write
â”œâ”€ Guarantee: File either fully written or not written
â”œâ”€ Used for: Transcripts, moments, audio, videos
â”œâ”€ Failure mode: Operation retries until success
â””â”€ Best for: Durable data storage

EVENTUAL CONSISTENCY (Redis Cache)
â”œâ”€ Operations: Set with TTL (1 hour)
â”œâ”€ Guarantee: Data expires automatically
â”œâ”€ Used for: API response caching, rate limiting
â”œâ”€ Failure mode: Cache miss â†’ Re-fetch from R2/API
â””â”€ Best for: Performance optimization

VECTOR CONSISTENCY (Vectorize)
â”œâ”€ Operations: Upsert embeddings
â”œâ”€ Guarantee: Vector always matches latest moment
â”œâ”€ Used for: Semantic search index
â”œâ”€ Failure mode: Re-index on update
â””â”€ Best for: Search accuracy

TRANSACTIONAL INTEGRITY
â”œâ”€ Single worker per operation:
â”‚  â”œâ”€ Ingest: Atomic (fetch â†’ parse â†’ store)
â”‚  â”œâ”€ Moments: Atomic (analyze â†’ score â†’ embed)
â”‚  â”œâ”€ Assets: Atomic (script â†’ audio â†’ thumbnail)
â”‚  â””â”€ Composition: Atomic (render â†’ publish)
â”œâ”€ Cross-worker:
â”‚  â””â”€ Eventual consistency (relies on IDs)
â””â”€ All-or-nothing: Each worker operation complete or fail

IDEMPOTENCY
â”œâ”€ Ingest: Can re-ingest same transcript
â”‚  â””â”€ Returns same transcript_id
â”œâ”€ Moments: Can re-extract same transcript
â”‚  â””â”€ Returns same moment IDs (cached in R2)
â”œâ”€ Assets: Can re-generate same moment
â”‚  â””â”€ Returns same script/audio/thumbnail
â””â”€ Composition: Can retry failed render jobs
   â””â”€ Same job_id for retry

FAILURE RECOVERY
â”œâ”€ ingest fails:
â”‚  â””â”€ Retry Parliament API, cache miss on retry
â”œâ”€ moments fails:
â”‚  â””â”€ Reload transcript, retry OpenAI (may get different scores)
â”œâ”€ video-matcher fails:
â”‚  â””â”€ Retry YouTube search, may find different video
â”œâ”€ assets fails:
â”‚  â””â”€ Retry script generation (scores may differ due to LLM randomness)
â””â”€ composition fails:
   â””â”€ Retry Modal job, may need to restart from scratch
```

