name = "capless-parliament-scraper"
main = "src/index.ts"
compatibility_date = "2024-10-01"
compatibility_flags = ["nodejs_compat"]

# R2 bucket for storing raw Hansard responses
[[r2_buckets]]
binding = "R2"
bucket_name = "capless-preview"

# Queue for processing dates with rate limiting
[[queues.producers]]
queue = "parliament-dates-queue"
binding = "DATES_QUEUE"

[[queues.consumers]]
queue = "parliament-dates-queue"
max_batch_size = 10  # Process 10 dates per batch
max_batch_timeout = 60  # Wait up to 60 seconds for batch
max_retries = 3  # Retry failed dates 3 times
dead_letter_queue = "parliament-dates-dlq"

# Daily cron triggers for checking new Hansard reports
# Runs at 12mn, 8am, 12noon Singapore time (UTC+8)
[triggers]
crons = ["0 16 * * *", "0 0 * * *", "0 4 * * *"]  # 12mn, 8am, 12noon SGT in UTC

[env.development]
name = "capless-parliament-scraper-dev"
