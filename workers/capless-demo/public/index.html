<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capless - Viral Parliamentary Moments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Capless</h1>
                    <p class="text-sm text-gray-500 mt-1">Parliament Session: 22 September 2025</p>
                </div>
                <div class="text-right">
                    <p class="text-sm font-medium text-gray-600">Viral Moments Detected</p>
                    <p class="text-3xl font-bold text-indigo-600" id="momentCount">3</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Panel: YouTube Video -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="bg-gray-900 aspect-video relative">
                    <div id="player"></div>
                </div>
                <div class="p-4 border-t border-gray-200">
                    <h3 class="font-semibold text-gray-900 mb-2">Parliament Sitting 22 September 2025</h3>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-500" id="currentTimestamp">00:00:00</span>
                        <a href="https://www.youtube.com/watch?v=n9ZyN-lwiXg" target="_blank"
                           class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                            Watch on YouTube â†’
                        </a>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Viral Moments List -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden flex flex-col max-h-[600px]">
                <div class="p-4 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50">
                    <h2 class="text-lg font-bold text-gray-900">Viral Moments</h2>
                    <p class="text-sm text-gray-600 mt-1">Click any moment to jump to the timestamp</p>
                </div>

                <div class="overflow-y-auto flex-1" id="momentsList">
                    <!-- Moments will be loaded here by JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <!-- App JavaScript -->
    <script>
        // Hardcoded data
        const VIDEO_ID = 'n9ZyN-lwiXg';
        const MOMENTS = [
            {
                "moment_id": "demo-moment-1",
                "quote": "The alterations were done to cover up the incompleteness of documents but the contents were factual.",
                "speaker": "Minister (PUB)",
                "timestamp_start": "01:29:46",
                "virality_score": 10,
                "why_viral": "Minimizes document falsification - sounds like cover-up language",
                "topic": "Public Sector Integrity"
            },
            {
                "moment_id": "demo-moment-2",
                "quote": "It is challenging for the government to allocate COEs based on needs. No matter how one draws the line, there will always be people who believe they are more deserving.",
                "speaker": "Transport Minister",
                "timestamp_start": "09:20:34",
                "virality_score": 10,
                "why_viral": "Admits difficulty but uses it as reason for inaction - excuse-making rather than problem-solving",
                "topic": "COE policy and fairness"
            },
            {
                "moment_id": "demo-moment-3",
                "quote": "The market mechanism is transparent and allows government to channel COE revenues to benefit the wider public.",
                "speaker": "Transport Minister",
                "timestamp_start": "09:24:37",
                "virality_score": 10,
                "why_viral": "Defends market-based system as fair while acknowledging it prices out families - contradictory logic",
                "topic": "COE policy and market mechanism"
            }
        ];

        let player;
        let currentMomentIndex = null;

        // Convert timestamp HH:MM:SS to seconds
        function timestampToSeconds(timestamp) {
            const parts = timestamp.split(':').map(Number);
            return parts[0] * 3600 + parts[1] * 60 + parts[2];
        }

        // Convert seconds to HH:MM:SS
        function secondsToTimestamp(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        // YouTube Player Ready
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: VIDEO_ID,
                playerVars: {
                    'playsinline': 1,
                    'rel': 0,
                    'modestbranding': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            console.log('YouTube player ready');
            // Update current time display
            setInterval(() => {
                if (player && player.getCurrentTime) {
                    const currentTime = player.getCurrentTime();
                    document.getElementById('currentTimestamp').textContent = secondsToTimestamp(currentTime);
                }
            }, 1000);
        }

        function onPlayerStateChange(event) {
            // Handle player state changes if needed
        }

        // Jump to timestamp in video
        function jumpToTimestamp(timestamp, momentIndex) {
            const seconds = timestampToSeconds(timestamp);
            if (player && player.seekTo) {
                player.seekTo(seconds, true);
                player.playVideo();

                // Update active moment
                currentMomentIndex = momentIndex;
                renderMoments();
            }
        }

        // Generate reaction video (placeholder)
        function generateReactionVideo(moment) {
            alert(`Generate Reaction Video\n\nMoment: "${moment.quote}"\nSpeaker: ${moment.speaker}\n\n[Feature coming soon in full version]`);
        }

        // Render moments list
        function renderMoments() {
            const momentsList = document.getElementById('momentsList');
            momentsList.innerHTML = MOMENTS.map((moment, index) => {
                const isActive = currentMomentIndex === index;
                return `
                    <div class="p-4 border-b border-gray-200 hover:bg-gray-50 transition-colors cursor-pointer ${isActive ? 'bg-indigo-50 border-l-4 border-l-indigo-600' : ''}"
                         onclick="jumpToTimestamp('${moment.timestamp_start}', ${index})">

                        <!-- Header: Speaker & Timestamp -->
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                                    ${moment.speaker}
                                </span>
                                <span class="text-xs text-gray-500">${moment.timestamp_start}</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"/>
                                </svg>
                                <span class="text-sm font-bold text-red-500">${moment.virality_score}</span>
                            </div>
                        </div>

                        <!-- Quote -->
                        <blockquote class="text-sm text-gray-900 leading-relaxed mb-3 italic border-l-3 border-gray-300 pl-3">
                            "${moment.quote}"
                        </blockquote>

                        <!-- Why Viral -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-3">
                            <p class="text-xs font-semibold text-yellow-800 mb-1">ðŸ”¥ Why This Will Go Viral:</p>
                            <p class="text-xs text-yellow-900">${moment.why_viral}</p>
                        </div>

                        <!-- Topic Badge -->
                        <div class="flex items-center justify-between">
                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-700">
                                ðŸ“‹ ${moment.topic}
                            </span>
                            <button
                                onclick="event.stopPropagation(); generateReactionVideo(${JSON.stringify(moment).replace(/"/g, '&quot;')})"
                                class="px-3 py-1 text-xs font-medium text-white bg-indigo-600 rounded hover:bg-indigo-700 transition-colors">
                                Generate Clip
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            renderMoments();
        });
    </script>
</body>
</html>
